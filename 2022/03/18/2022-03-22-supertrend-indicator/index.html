<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/favicon.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"mikelhsia.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="I have to admit that my attention was drawn by the name of this indicator at the first glance. Therefore my interest in implementing a series of backtesting against this indicator was unavoid">
<meta property="og:type" content="article">
<meta property="og:title" content="Yes or No? Adopting the Supertrend indicator in your trading strategies?">
<meta property="og:url" content="http://mikelhsia.github.io/2022/03/18/2022-03-22-supertrend-indicator/index.html">
<meta property="og:site_name" content="Michael&#39;s blog">
<meta property="og:description" content="I have to admit that my attention was drawn by the name of this indicator at the first glance. Therefore my interest in implementing a series of backtesting against this indicator was unavoid">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://mikelhsia.github.io/2022/03/18/2022-03-22-supertrend-indicator/cover.png">
<meta property="og:image" content="http://mikelhsia.github.io/2022/03/18/2022-03-22-supertrend-indicator/data.png">
<meta property="og:image" content="http://mikelhsia.github.io/2022/03/18/2022-03-22-supertrend-indicator/close_atr_data.png">
<meta property="og:image" content="http://mikelhsia.github.io/2022/03/18/2022-03-22-supertrend-indicator/final_data.png">
<meta property="og:image" content="http://mikelhsia.github.io/2022/03/18/2022-03-22-supertrend-indicator/supertrend.png">
<meta property="article:published_time" content="2022-03-17T17:20:43.000Z">
<meta property="article:modified_time" content="2022-03-18T18:40:10.596Z">
<meta property="article:author" content="Michael Hsia">
<meta property="article:tag" content="Momentum">
<meta property="article:tag" content="Technical Analysis">
<meta property="article:tag" content="Backtesting">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://mikelhsia.github.io/2022/03/18/2022-03-22-supertrend-indicator/cover.png">

<link rel="canonical" href="http://mikelhsia.github.io/2022/03/18/2022-03-22-supertrend-indicator/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Yes or No? Adopting the Supertrend indicator in your trading strategies? | Michael's blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-177399736-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-177399736-1');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Michael's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Michael's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Life-long Learning</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://mikelhsia.github.io/2022/03/18/2022-03-22-supertrend-indicator/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Michael Hsia">
      <meta itemprop="description" content="Free your potential with learning for the rest of your life">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Michael's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Yes or No? Adopting the Supertrend indicator in your trading strategies?
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-03-18 01:20:43" itemprop="dateCreated datePublished" datetime="2022-03-18T01:20:43+08:00">2022-03-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-03-19 02:40:10" itemprop="dateModified" datetime="2022-03-19T02:40:10+08:00">2022-03-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Quantitative-Trading/" itemprop="url" rel="index"><span itemprop="name">Quantitative Trading</span></a>
                </span>
            </span>

          
            <span id="/2022/03/18/2022-03-22-supertrend-indicator/" class="post-meta-item leancloud_visitors" data-flag-title="Yes or No? Adopting the Supertrend indicator in your trading strategies?" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/03/18/2022-03-22-supertrend-indicator/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/03/18/2022-03-22-supertrend-indicator/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <img data-src="/2022/03/18/2022-03-22-supertrend-indicator/cover.png" class="" width="600">
<p style="font-size: 0.8em; text-align:center; color: grey;">
    <i></i>
</p>

<p>I have to admit that my attention was drawn by the name of this indicator at the first glance. Therefore my interest in implementing a series of backtesting against this indicator was unavoidable. In today’s article, we’re going to introduce what Supertrend indicator is about and how to produce one yourself. After that, I will show you a series of backtest that I have performed and see what we can get out of them.</p>
<a id="more"></a>
<h1 id="Introduce-Supertrend-indicator"><a href="#Introduce-Supertrend-indicator" class="headerlink" title="Introduce Supertrend indicator"></a>Introduce Supertrend indicator</h1><h2 id="What-is-Supertrend"><a href="#What-is-Supertrend" class="headerlink" title="What is Supertrend"></a>What is Supertrend</h2><p>Supertrend indicator was created by Olivier Seban to help identify trends and to know when to buy or sell a financial asset. Similar to Bollinger Bands, Supertrend involves an upper band and a lower band that is derived from the close price in order to find out the signals to show the trend of prices. Essentially, it is a trend-following (lagging) indicator.</p>
<p>When we construct the Supertrend indicator strategy, the default parameters involve using Average True Range (ATR) with the period of 14 and another parameter of 2 as its multiplier. The average true range (ATR) plays a key role in Supertrend as the indicator uses ATR to compute its upper- and lower- band values in results triggering the buy and sell signals.</p>
<h2 id="Pros-and-cons-of-Supertrend"><a href="#Pros-and-cons-of-Supertrend" class="headerlink" title="Pros and cons of Supertrend"></a>Pros and cons of Supertrend</h2><p>However, Super Trend needs to be used in conjunction with other indicators like RSI, MACD, and any other technical indicators in order to produce more accurate and confirmed signals.  Moreover, Supertrend also works best with a trailing stop-loss for the existing trades and acts as strong support or resistance.to use in combination with other indicators like MACD and RSI. We can list its pros and cons below to quickly understand Supertrend:</p>
<ul>
<li>Advantages of SuperTrend Indicator<ul>
<li>The best thing about Supertrend is it sends out accurate signals.</li>
<li>The indicator offers a quick technical analysis to intraday traders.</li>
<li>It is easy to use and understand.</li>
</ul>
</li>
<li>Disadvantages<ul>
<li>The Supertrend is not appropriate for all situations, which works when the market is trending.</li>
<li>Supertrend is best for singling out the trend, but it needs to cooperate with other indicators to decide the best timing to trade.</li>
<li>Supertrend uses only the two parameters of ATR and multiplier. They are not sufficient under certain conditions to predict the accurate direction of the market.</li>
</ul>
</li>
</ul>
<h2 id="How-to-calculate-Supertrend-indicator"><a href="#How-to-calculate-Supertrend-indicator" class="headerlink" title="How to calculate Supertrend indicator"></a>How to calculate Supertrend indicator</h2><p>Here I’m using the research book from <a target="_blank" rel="noopener" href="https://www.quantconnect.com/">QuantConnect</a> to demonstrate the calculation of Supertrend indicator.</p>
<h3 id="1-Retrieve-close-and-ATR-data"><a href="#1-Retrieve-close-and-ATR-data" class="headerlink" title="1. Retrieve close and ATR data"></a>1. Retrieve close and ATR data</h3><p>First of all, we need to retrieve the close price and the ATR indicator from historical data:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">qb &#x3D; QuantBook()</span><br><span class="line">stock &#x3D; qb.AddEquity(&quot;AAPL&quot;)</span><br><span class="line">history &#x3D; qb.History(qb.Securities.Keys, 720, Resolution.Daily)</span><br><span class="line">atr &#x3D; qb.Indicator(AverageTrueRange(14), stock.Symbol, 720, Resolution.Daily)</span><br><span class="line"></span><br><span class="line">his &#x3D; history.swaplevel().droplevel(1)</span><br><span class="line">his[&#39;atr&#39;] &#x3D; atr[&#39;averagetruerange&#39;]</span><br><span class="line">his.dropna(inplace&#x3D;True)</span><br><span class="line"></span><br><span class="line">his[[&#39;close&#39;, &#39;atr&#39;]].head()</span><br></pre></td></tr></table></figure></p>
<img data-src="/2022/03/18/2022-03-22-supertrend-indicator/data.png" class="" width="600">
<p style="font-size: 0.8em; text-align:center; color: grey;">
    <i></i>
</p>

<h3 id="2-The-basic-upper-and-lower-bands"><a href="#2-The-basic-upper-and-lower-bands" class="headerlink" title="2. The basic upper- and lower- bands"></a>2. The basic upper- and lower- bands</h3><p>Then we need to calculate the basic upperband and lowerband utilizing the daily 14-period ATR. These basic bands fundamentally are the volatility through using the ATR indicator to see the possible fluctuation against current close price. The formulas are as follows:</p>
<script type="math/tex; mode=display">\text{Basic upperband} = \frac{\text{High + Low}}{2} + \text{Multiplier} \times \text{ATR}</script><script type="math/tex; mode=display">\text{Basic lowerband} = \frac{\text{High + Low}}{2} - \text{Multiplier} \times \text{ATR}</script><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">his[&#39;hl2&#39;] &#x3D; (his[&#39;high&#39;] + his[&#39;low&#39;])&#x2F;2</span><br><span class="line">his[&#39;basic_upper&#39;] &#x3D; his[&#39;hl2&#39;] + his[&#39;atr&#39;] * 2</span><br><span class="line">his[&#39;basic_lower&#39;] &#x3D; his[&#39;hl2&#39;] - his[&#39;atr&#39;] * 2</span><br><span class="line"></span><br><span class="line">his[[&#39;basic_upper&#39;, &#39;basic_lower&#39;, &#39;close&#39;]].plot(figsize&#x3D;(15,10))</span><br></pre></td></tr></table></figure>
<img data-src="/2022/03/18/2022-03-22-supertrend-indicator/close_atr_data.png" class="" width="600">
<p style="font-size: 0.8em; text-align:center; color: grey;">
    <i></i>
</p>

<h3 id="3-Calculate-the-final-upper-and-lower-bands"><a href="#3-Calculate-the-final-upper-and-lower-bands" class="headerlink" title="3. Calculate the final upper- and lower- bands"></a>3. Calculate the final upper- and lower- bands</h3><p>This step is to smooth the basic upperband and lowerband. In many indicators, we use moving average or other techniques to smooth the bands. Here we’re trying to use a different way to smooth them.</p>
<script type="math/tex; mode=display">If\ \text{(Basic upperband < Previous final upperband)}\ or \ \text{(Previous close > Previous final upperband)}</script><script type="math/tex; mode=display">\text{Final upperband} = \text{Basic upperband}</script><script type="math/tex; mode=display">else</script><script type="math/tex; mode=display">\text{Final upperband} = \text{Previous final upperband}</script><script type="math/tex; mode=display">If\ \text{(Basic lowerband > Previous final lowerband)}\ or \ \text{(Previous close < Previous final lowerband)}</script><script type="math/tex; mode=display">\text{Final lowerband} = \text{Basic lowerband}</script><script type="math/tex; mode=display">else</script><script type="math/tex; mode=display">\text{Final upperband} = \text{Previous final lowerband}</script><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">his[&#39;final_upper&#39;] &#x3D; his[&#39;basic_upper&#39;] - his[&#39;basic_upper&#39;]</span><br><span class="line">his[&#39;final_lower&#39;] &#x3D; his[&#39;basic_upper&#39;] - his[&#39;basic_upper&#39;]</span><br><span class="line"></span><br><span class="line">for i in range(len(his)):</span><br><span class="line">    if i &#x3D;&#x3D; 0:</span><br><span class="line">        his.loc[his.index.values[i], &#39;final_upper&#39;] &#x3D; 0</span><br><span class="line">    else:</span><br><span class="line">        if (his.loc[his.index.values[i], &#39;basic_upper&#39;] &lt; his.loc[his.index.values[i-1], &#39;final_upper&#39;]) | (his.loc[his.index.values[i-1], &#39;close&#39;] &gt; his.loc[his.index.values[i-1], &#39;final_upper&#39;]):</span><br><span class="line">            his.loc[his.index.values[i], &#39;final_upper&#39;] &#x3D; his.loc[his.index.values[i], &#39;basic_upper&#39;]</span><br><span class="line">        else:</span><br><span class="line">            his.loc[his.index.values[i], &#39;final_upper&#39;] &#x3D; his.loc[his.index.values[i-1], &#39;final_upper&#39;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for i in range(len(his)):</span><br><span class="line">    if i &#x3D;&#x3D; 0:</span><br><span class="line">        his.loc[his.index.values[i], &#39;final_lower&#39;] &#x3D; 0</span><br><span class="line">    else:</span><br><span class="line">        if (his.loc[his.index.values[i], &#39;basic_lower&#39;] &gt; his.loc[his.index.values[i-1], &#39;final_lower&#39;]) | (his.loc[his.index.values[i-1], &#39;close&#39;] &lt; his.loc[his.index.values[i-1], &#39;final_lower&#39;]):</span><br><span class="line">            his.loc[his.index.values[i], &#39;final_lower&#39;] &#x3D; his.loc[his.index.values[i], &#39;basic_lower&#39;]</span><br><span class="line">        else:</span><br><span class="line">            his.loc[his.index.values[i], &#39;final_lower&#39;] &#x3D; his.loc[his.index.values[i-1], &#39;final_lower&#39;]</span><br></pre></td></tr></table></figure>
<img data-src="/2022/03/18/2022-03-22-supertrend-indicator/final_data.png" class="" width="600">
<p style="font-size: 0.8em; text-align:center; color: grey;">
    <i></i>
</p>

<h3 id="4-Define-the-Superband-indicator"><a href="#4-Define-the-Superband-indicator" class="headerlink" title="4. Define the Superband indicator"></a>4. Define the Superband indicator</h3><p>Lastly, we’re going to assemble the Superband with all the components that we have constructed above.</p>
<script type="math/tex; mode=display">If\ \text{(Close price < Final upperband)}\ and\ \text{(Previous Supertrend == Previous final upperband)}</script><script type="math/tex; mode=display">ext{Supertrend} = \text{Final upperband}</script><script type="math/tex; mode=display">If\ \text{(Close price > Final upperband)}\ and\ \text{(Previous Supertrend == Previous final upperband)}</script><script type="math/tex; mode=display">\text{Supertrend} = \text{Final lowerband}</script><script type="math/tex; mode=display">If\ \text{(Close price > Final lowerband)}\ and\ \text{(Previous Supertrend == Previous final lowerband)}</script><script type="math/tex; mode=display">\text{Supertrend} = \text{Final lowerband}</script><script type="math/tex; mode=display">If\ \text{(Close price < Final upperband)}\ and\ \text{(Previous Supertrend == Previous final lowerband)}</script><script type="math/tex; mode=display">\text{Supertrend} = \text{Final upperband}</script><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">his[&#39;supertrend&#39;] &#x3D; his[&#39;basic_upper&#39;] - his[&#39;basic_upper&#39;]</span><br><span class="line"></span><br><span class="line">for i in range(len(his[&#39;supertrend&#39;])):</span><br><span class="line">    if i &#x3D;&#x3D; 0:</span><br><span class="line">        his.loc[his.index.values[i], &#39;supertrend&#39;] &#x3D; 0</span><br><span class="line">    elif (his.loc[his.index.values[i-1], &#39;supertrend&#39;] &#x3D;&#x3D; his.loc[his.index.values[i-1], &#39;final_upper&#39;]) and (his.loc[his.index.values[i], &#39;close&#39;] &lt; his.loc[his.index.values[i], &#39;final_upper&#39;]):</span><br><span class="line">        his.loc[his.index.values[i], &#39;supertrend&#39;] &#x3D; his.loc[his.index.values[i], &#39;final_upper&#39;]</span><br><span class="line">    elif (his.loc[his.index.values[i-1], &#39;supertrend&#39;] &#x3D;&#x3D; his.loc[his.index.values[i-1], &#39;final_upper&#39;]) and (his.loc[his.index.values[i], &#39;close&#39;] &gt; his.loc[his.index.values[i], &#39;final_upper&#39;]):</span><br><span class="line">        his.loc[his.index.values[i], &#39;supertrend&#39;] &#x3D; his.loc[his.index.values[i], &#39;final_lower&#39;]</span><br><span class="line">    elif (his.loc[his.index.values[i-1], &#39;supertrend&#39;] &#x3D;&#x3D; his.loc[his.index.values[i-1], &#39;final_lower&#39;]) and (his.loc[his.index.values[i], &#39;close&#39;] &gt; his.loc[his.index.values[i], &#39;final_lower&#39;]):</span><br><span class="line">        his.loc[his.index.values[i], &#39;supertrend&#39;] &#x3D; his.loc[his.index.values[i], &#39;final_lower&#39;]</span><br><span class="line">    elif (his.loc[his.index.values[i-1], &#39;supertrend&#39;] &#x3D;&#x3D; his.loc[his.index.values[i-1], &#39;final_lower&#39;]) and (his.loc[his.index.values[i], &#39;close&#39;] &lt; his.loc[his.index.values[i], &#39;final_lower&#39;]):</span><br><span class="line">        his.loc[his.index.values[i], &#39;supertrend&#39;] &#x3D; his.loc[his.index.values[i], &#39;final_upper&#39;]</span><br><span class="line"></span><br><span class="line">his[[&#39;close&#39;, &#39;supertrend&#39;]].plot(figsize&#x3D;(15,10))</span><br></pre></td></tr></table></figure>
<img data-src="/2022/03/18/2022-03-22-supertrend-indicator/supertrend.png" class="" width="600">
<p style="font-size: 0.8em; text-align:center; color: grey;">
    <i></i>
</p>


<h1 id="Strategy-setups-for-our-backtests"><a href="#Strategy-setups-for-our-backtests" class="headerlink" title="Strategy setups for our backtests"></a>Strategy setups for our backtests</h1><p>After introducing what Superband is and how to calculate it, we’re now going to backtest this indicator in conjunction with other indicators and see how they perform.</p>
<h2 id="Platform"><a href="#Platform" class="headerlink" title="Platform"></a>Platform</h2><p><a target="_blank" rel="noopener" href="https://www.quantconnect.com/">QuantConnect</a></p>
<h2 id="Universe"><a href="#Universe" class="headerlink" title="Universe"></a>Universe</h2><ol>
<li>Sort stocks by <code>PERatio</code>, <code>EPS</code>, <code>ROE</code>, <code>NetIncome</code> and take top 60%</li>
<li>Sort stocks by <code>PBRatio</code>, from high to low</li>
</ol>
<h2 id="Rebalancing-strategy"><a href="#Rebalancing-strategy" class="headerlink" title="Rebalancing strategy"></a>Rebalancing strategy</h2><ol>
<li>Recalculate our universe and indicators every day.</li>
<li>We keep 10 stocks that have buy-in signals and with the highest <code>PBRatio</code>.</li>
<li>We assign weight to each position evenly.</li>
<li>We don’t adjust the weight of each stock until we close these positions.</li>
</ol>
<h2 id="Backtest-time-frame"><a href="#Backtest-time-frame" class="headerlink" title="Backtest time frame"></a>Backtest time frame</h2><p><strong>Backtest Date:</strong> <code>2019, 1 ,10</code> ~ <code>2022, 2, 14</code></p>
<h2 id="Signal-generation"><a href="#Signal-generation" class="headerlink" title="Signal generation"></a>Signal generation</h2><p>There’s no technical indicator that can be 100% accurate and so is Supertrend. Therefore we are going to backtest the performance of it combining other famous indicators.</p>
<h3 id="1-Supertrend-momentum-strategy"><a href="#1-Supertrend-momentum-strategy" class="headerlink" title="1. Supertrend momentum strategy"></a>1. Supertrend momentum strategy</h3><p>In this strategy, we buy when the close breaks through the Supertrend indicator, and sell when the close price falls below the Supertrend indicator.</p>
<h3 id="2-Supertrend-mean-reversion-strategy"><a href="#2-Supertrend-mean-reversion-strategy" class="headerlink" title="2. Supertrend mean-reversion strategy"></a>2. Supertrend mean-reversion strategy</h3><p>Compared to the above strategy, we do everything in reverse. We buy when the close price falls below the Supertrend, and sell when the close price goes above the Supertrend.</p>
<h3 id="3-Supertrend-with-RSI-indicator"><a href="#3-Supertrend-with-RSI-indicator" class="headerlink" title="3. Supertrend with RSI indicator"></a>3. Supertrend with RSI indicator</h3><p>We buy when the close price goes above the Supertrend also when RSI is above 50, and sell when the close price is under Supertrend and when RSI is below 50.</p>
<h3 id="4-Supertrend-with-EMA20-indicator"><a href="#4-Supertrend-with-EMA20-indicator" class="headerlink" title="4. Supertrend with EMA20 indicator"></a>4. Supertrend with EMA20 indicator</h3><p>We buy when the close price goes above the Supertrend also when 20-day EMA is above the close price, and sell when 20-day EMA is below the close price.</p>
<h3 id="5-Supertrend-with-EMA200-indicator"><a href="#5-Supertrend-with-EMA200-indicator" class="headerlink" title="5. Supertrend with EMA200 indicator"></a>5. Supertrend with EMA200 indicator</h3><p>We buy when the close price goes above the Supertrend also when 200-day EMA is above the close price, and sell when 200-day EMA is below the close price.</p>
<h3 id="6-Supertrend-with-William-R-indicator"><a href="#6-Supertrend-with-William-R-indicator" class="headerlink" title="6. Supertrend with William R indicator"></a>6. Supertrend with William R indicator</h3><p>We buy when the close price goes above the Supertrend also when the <a target="_blank" rel="noopener" href="https://www.investopedia.com/terms/w/williamsr.asp">William R indicator</a> is below -50, and sell when the close price is under Supertrend and when the William R indicator is above -50.</p>
<h3 id="7-Supertrend-with-Chande-momentum-oscillator"><a href="#7-Supertrend-with-Chande-momentum-oscillator" class="headerlink" title="7. Supertrend with Chande momentum oscillator"></a>7. Supertrend with Chande momentum oscillator</h3><p>We buy when the close price goes above the Supertrend also when the <a target="_blank" rel="noopener" href="https://www.investopedia.com/terms/c/chandemomentumoscillator.asp">Chande momentum oscillator</a> is below -50, and sell when the close price is under Supertrend and when the Chande momentum oscillator is above 50.</p>
<h3 id="8-Supertrend-with-10-trailing-stop-loss"><a href="#8-Supertrend-with-10-trailing-stop-loss" class="headerlink" title="8. Supertrend with 10% trailing stop loss"></a>8. Supertrend with 10% trailing stop loss</h3><p>In addition to the setup of the first momentum strategy, we add a trail stop loss if the close price falls 10% in two consecutive days.</p>
<h2 id="Backtest-result"><a href="#Backtest-result" class="headerlink" title="Backtest result"></a>Backtest result</h2><div class="table-container">
<table>
<thead>
<tr>
<th>Strategy</th>
<th>Total Trades</th>
<th>PSR</th>
<th>Unrealized</th>
<th>Fee</th>
<th>Net profit</th>
<th>Return</th>
<th>Sharpe</th>
<th>Average Win</th>
<th>Average Loss</th>
<th>Compounding annual return</th>
<th>MDD</th>
<th>Profit-loss ratio</th>
<th>Win rate</th>
<th>Alpha</th>
<th>Beta</th>
<th>Annual variance</th>
</tr>
</thead>
<tbody>
<tr>
<td>momentum</td>
<td>607</td>
<td>41.256%</td>
<td>$12622.29</td>
<td>-$2470.65</td>
<td>$132108.37</td>
<td>142.34%</td>
<td>1.007</td>
<td>1,83%</td>
<td>-0.75%</td>
<td>32.7%</td>
<td>32.9%</td>
<td>2.43</td>
<td>42%</td>
<td>0.152</td>
<td>0.684</td>
<td>0.064</td>
</tr>
<tr>
<td>momentum_trailing_loss</td>
<td>635</td>
<td>22.944%</td>
<td>$9576.2</td>
<td>-$2201</td>
<td>$59980.43</td>
<td>67.39%</td>
<td>0.698</td>
<td>1.32%</td>
<td>-0.69%</td>
<td>17.898%</td>
<td>30.2%</td>
<td>1.91</td>
<td>42%</td>
<td>0.017</td>
<td>0.603</td>
<td>0.042  </td>
</tr>
<tr>
<td>mean-reversion</td>
<td>366</td>
<td>21.47%</td>
<td>-$17538.55</td>
<td>-$1295.34</td>
<td>$83620</td>
<td>64.81%</td>
<td>0.665</td>
<td>1.09%</td>
<td>-1.33%</td>
<td>17.315%</td>
<td>35.2%</td>
<td>0.82</td>
<td>70%</td>
<td>0.013</td>
<td>0.873</td>
<td>0.046</td>
</tr>
<tr>
<td>rsi</td>
<td>607</td>
<td>41.256%</td>
<td>$12622.29</td>
<td>-$2470.65</td>
<td>$132108.37</td>
<td>142.34%</td>
<td>1.007</td>
<td>1,83%</td>
<td>-0.75%</td>
<td>32.7%</td>
<td>32.9%</td>
<td>2.43</td>
<td>42%</td>
<td>0.152</td>
<td>0.684</td>
<td>0.064</td>
</tr>
<tr>
<td>ema20</td>
<td>970</td>
<td>10.581%</td>
<td>$3031.88</td>
<td>-$3230.26</td>
<td>$32780.4</td>
<td>34.6%</td>
<td>0.433</td>
<td>1.05%</td>
<td>-0.46%</td>
<td>9.437%</td>
<td>30.6%</td>
<td>2.26</td>
<td>35%</td>
<td>0.01</td>
<td>0.496</td>
<td>0.037</td>
</tr>
<tr>
<td>ema200</td>
<td>164</td>
<td>33.474%</td>
<td>-$3699</td>
<td>-$640.42</td>
<td>$161398.96</td>
<td>157.22%</td>
<td>0.913</td>
<td>6.00%</td>
<td>-1.20%</td>
<td>35.251%</td>
<td>38.5%</td>
<td>4.98</td>
<td>36%</td>
<td>0.087</td>
<td>1.013</td>
<td>0.108</td>
</tr>
<tr>
<td>william_r</td>
<td>28</td>
<td>24.792%</td>
<td>$63412</td>
<td>-$68</td>
<td>$19756</td>
<td>83.14%</td>
<td>0.733</td>
<td>4.90%</td>
<td>-1.44%</td>
<td>21.336%</td>
<td>41.00%</td>
<td>3.39</td>
<td>56%</td>
<td>-0.011</td>
<td>0.891</td>
<td>0.058</td>
</tr>
<tr>
<td>chande_momentum</td>
<td>0</td>
<td>0</td>
<td>$0</td>
<td>$0</td>
<td>$0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0   </td>
</tr>
</tbody>
</table>
</div>
<h2 id="Takeout-from-the-backtest-results"><a href="#Takeout-from-the-backtest-results" class="headerlink" title="Takeout from the backtest results"></a>Takeout from the backtest results</h2><p>The SPY return in our backtest period is around 74%. By looking at the statistics above, all the backtests seem very promising. But all the PSR (Probabilistic Sharpe Ratio) are fairly low (<em>See <a href="https://mikelhsia.github.io/2022/02/19/2022-02-17-machine-learning-performance-evaluation/">here</a> if you don’t know what PSR stands for</em>). Also, the win rate in every backtest scenario is hardly over 50%. All these facts indicate that our Supertrend strategies don’t work really well.</p>
<p>There are other things that we can try to add to optimize our strategies:</p>
<ul>
<li>Find the appropriate universe that fit the nature of the Supertrend indicator.</li>
<li>Fine-tune the parameters used in our indicators</li>
<li>Combine the Supertrend indicator with other indicators.</li>
</ul>
<p>Of course, exploring the combination of different indicators could be a good way to level up your backtest score. But make sure you don’t go too extreme and go overfitting. Remember, history won’t repeat itself in the stock market. What we’re doing here is simply trying to find a way that can help us better confirm the time when the trend changes.</p>
<hr>
<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://wire.insiderfinance.io/backtest-supertrend-crossover-strategy-with-elasticsearch-ab048a3c6b8">Backtest supertrend crossover strategy</a></li>
<li><a target="_blank" rel="noopener" href="https://www.elearnmarkets.com/blog/supertrend-indicator-strategy-trading/">Supertrend Indicator : How to use for Intraday trading?</a></li>
<li><a target="_blank" rel="noopener" href="https://www.tradingfuel.com/supertrend-indicator-formula-and-calculation/">What is the SuperTrend Indicator</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/codex/step-by-step-implementation-of-the-supertrend-indicator-in-python-656aa678c111">A Step-By-Step Guide to Implementing the SuperTrend Indicator in Python</a></li>
</ul>

    </div>
    
      
        <div>
    <p style="color: grey; font-family: Georgia; font-size: 1.2em;"><i>
        Disclaimer: Nothing herein is financial advice or even a recommendation to trade real money. Many platforms exist for simulated trading (paper trading) which can be used for building and developing the strategies discussed. Please use common sense and consult a professional before trading or investing your hard-earned money.
    </i></p>
</div>




      
    

    
    
    
        <div class="reward-container">
  <div>Enjoy reading? Some donations would motivate me to produce more quality content</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    Tip
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="Michael Hsia WeChat Pay">
        <p>WeChat Pay</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="Michael Hsia Alipay">
        <p>Alipay</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/stripe.png" alt="Michael Hsia Stripe">
        <p>Stripe</p>
      </div>

  </div>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Momentum/" rel="tag"># Momentum</a>
              <a href="/tags/Technical-Analysis/" rel="tag"># Technical Analysis</a>
              <a href="/tags/Backtesting/" rel="tag"># Backtesting</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/02/19/2022-02-17-machine-learning-performance-evaluation/" rel="prev" title="【ML algo trading】 IV - How to analyze how good my machine learning strategy is?">
      <i class="fa fa-chevron-left"></i> 【ML algo trading】 IV - How to analyze how good my machine learning strategy is?
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/04/18/2022-04-20-forex-grid-trading-system/" rel="next" title="Looking for no-loss trading strategy? Here's the strategy that you should look at.">
      Looking for no-loss trading strategy? Here's the strategy that you should look at. <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Introduce-Supertrend-indicator"><span class="nav-number">1.</span> <span class="nav-text">Introduce Supertrend indicator</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#What-is-Supertrend"><span class="nav-number">1.1.</span> <span class="nav-text">What is Supertrend</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pros-and-cons-of-Supertrend"><span class="nav-number">1.2.</span> <span class="nav-text">Pros and cons of Supertrend</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-to-calculate-Supertrend-indicator"><span class="nav-number">1.3.</span> <span class="nav-text">How to calculate Supertrend indicator</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Retrieve-close-and-ATR-data"><span class="nav-number">1.3.1.</span> <span class="nav-text">1. Retrieve close and ATR data</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-The-basic-upper-and-lower-bands"><span class="nav-number">1.3.2.</span> <span class="nav-text">2. The basic upper- and lower- bands</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-Calculate-the-final-upper-and-lower-bands"><span class="nav-number">1.3.3.</span> <span class="nav-text">3. Calculate the final upper- and lower- bands</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-Define-the-Superband-indicator"><span class="nav-number">1.3.4.</span> <span class="nav-text">4. Define the Superband indicator</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Strategy-setups-for-our-backtests"><span class="nav-number">2.</span> <span class="nav-text">Strategy setups for our backtests</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Platform"><span class="nav-number">2.1.</span> <span class="nav-text">Platform</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Universe"><span class="nav-number">2.2.</span> <span class="nav-text">Universe</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Rebalancing-strategy"><span class="nav-number">2.3.</span> <span class="nav-text">Rebalancing strategy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Backtest-time-frame"><span class="nav-number">2.4.</span> <span class="nav-text">Backtest time frame</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Signal-generation"><span class="nav-number">2.5.</span> <span class="nav-text">Signal generation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Supertrend-momentum-strategy"><span class="nav-number">2.5.1.</span> <span class="nav-text">1. Supertrend momentum strategy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Supertrend-mean-reversion-strategy"><span class="nav-number">2.5.2.</span> <span class="nav-text">2. Supertrend mean-reversion strategy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-Supertrend-with-RSI-indicator"><span class="nav-number">2.5.3.</span> <span class="nav-text">3. Supertrend with RSI indicator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-Supertrend-with-EMA20-indicator"><span class="nav-number">2.5.4.</span> <span class="nav-text">4. Supertrend with EMA20 indicator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-Supertrend-with-EMA200-indicator"><span class="nav-number">2.5.5.</span> <span class="nav-text">5. Supertrend with EMA200 indicator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-Supertrend-with-William-R-indicator"><span class="nav-number">2.5.6.</span> <span class="nav-text">6. Supertrend with William R indicator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-Supertrend-with-Chande-momentum-oscillator"><span class="nav-number">2.5.7.</span> <span class="nav-text">7. Supertrend with Chande momentum oscillator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-Supertrend-with-10-trailing-stop-loss"><span class="nav-number">2.5.8.</span> <span class="nav-text">8. Supertrend with 10% trailing stop loss</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Backtest-result"><span class="nav-number">2.6.</span> <span class="nav-text">Backtest result</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Takeout-from-the-backtest-results"><span class="nav-number">2.7.</span> <span class="nav-text">Takeout from the backtest results</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Misc"><span class="nav-number">3.</span> <span class="nav-text">Misc</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Reference"><span class="nav-number">3.1.</span> <span class="nav-text">Reference</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Michael Hsia</p>
  <div class="site-description" itemprop="description">Free your potential with learning for the rest of your life</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">52</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">tags</span></a>
      </div>

  </nav>
    

  <div class="">

    <div class="">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>

</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Michael Hsia</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'xqc1TRzBeSqWMcMIO6i05hrV-MdYXbMMI',
      appKey     : '8y8oPqyB7YE9KwpM33MRijdR',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : 'https://xqc1trzb.api.lncldglobal.com'
    });
  }, window.Valine);
});
</script>

</body>
</html>
