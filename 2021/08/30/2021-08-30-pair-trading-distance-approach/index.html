<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/favicon.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"mikelhsia.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Previous readings     【Pair Trading】Introduction to pair trading strategy     After knowing what the pair trading strategy is about from the previous post, we’re going to use the QuantCon">
<meta property="og:type" content="article">
<meta property="og:title" content="【Pair Trading】Part 2. 5 in-depth analysis of distance approach in pair trading">
<meta property="og:url" content="http://mikelhsia.github.io/2021/08/30/2021-08-30-pair-trading-distance-approach/index.html">
<meta property="og:site_name" content="Michael&#39;s blog">
<meta property="og:description" content="Previous readings     【Pair Trading】Introduction to pair trading strategy     After knowing what the pair trading strategy is about from the previous post, we’re going to use the QuantCon">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://mikelhsia.github.io/2021/08/30/2021-08-30-pair-trading-distance-approach/cover.jpg">
<meta property="og:image" content="http://mikelhsia.github.io/2021/08/30/2021-08-30-pair-trading-distance-approach/get_started.jpg">
<meta property="og:image" content="http://mikelhsia.github.io/2021/08/30/2021-08-30-pair-trading-distance-approach/basic_stratified.png">
<meta property="og:image" content="http://mikelhsia.github.io/2021/08/30/2021-08-30-pair-trading-distance-approach/basic_top.png">
<meta property="og:image" content="http://mikelhsia.github.io/2021/08/30/2021-08-30-pair-trading-distance-approach/same_industry_stratified.png">
<meta property="og:image" content="http://mikelhsia.github.io/2021/08/30/2021-08-30-pair-trading-distance-approach/same_industry_return_by_sector.png">
<meta property="og:image" content="http://mikelhsia.github.io/2021/08/30/2021-08-30-pair-trading-distance-approach/same_industry_top.png">
<meta property="og:image" content="http://mikelhsia.github.io/2021/08/30/2021-08-30-pair-trading-distance-approach/zero-crossing.png">
<meta property="og:image" content="http://mikelhsia.github.io/2021/08/30/2021-08-30-pair-trading-distance-approach/zerocrossing_stratified.png">
<meta property="og:image" content="http://mikelhsia.github.io/2021/08/30/2021-08-30-pair-trading-distance-approach/zerocrossing_top.png">
<meta property="og:image" content="http://mikelhsia.github.io/2021/08/30/2021-08-30-pair-trading-distance-approach/high_variance_stratified.png">
<meta property="og:image" content="http://mikelhsia.github.io/2021/08/30/2021-08-30-pair-trading-distance-approach/high_variance_top.png">
<meta property="og:image" content="http://mikelhsia.github.io/2021/08/30/2021-08-30-pair-trading-distance-approach/one_track_many.jpeg">
<meta property="og:image" content="http://mikelhsia.github.io/2021/08/30/2021-08-30-pair-trading-distance-approach/pearson_correlation.png">
<meta property="og:image" content="http://mikelhsia.github.io/2021/08/30/2021-08-30-pair-trading-distance-approach/homerun.jpg">
<meta property="article:published_time" content="2021-08-30T07:50:39.000Z">
<meta property="article:modified_time" content="2021-10-12T12:21:24.471Z">
<meta property="article:author" content="Michael Hsia">
<meta property="article:tag" content="Strategy">
<meta property="article:tag" content="Research">
<meta property="article:tag" content="Pair Trading">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://mikelhsia.github.io/2021/08/30/2021-08-30-pair-trading-distance-approach/cover.jpg">

<link rel="canonical" href="http://mikelhsia.github.io/2021/08/30/2021-08-30-pair-trading-distance-approach/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>【Pair Trading】Part 2. 5 in-depth analysis of distance approach in pair trading | Michael's blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-177399736-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-177399736-1');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Michael's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Michael's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Life-long Learning</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://mikelhsia.github.io/2021/08/30/2021-08-30-pair-trading-distance-approach/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Michael Hsia">
      <meta itemprop="description" content="Free your potential with learning for the rest of your life">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Michael's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          【Pair Trading】Part 2. 5 in-depth analysis of distance approach in pair trading
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-08-30 15:50:39" itemprop="dateCreated datePublished" datetime="2021-08-30T15:50:39+08:00">2021-08-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-10-12 20:21:24" itemprop="dateModified" datetime="2021-10-12T20:21:24+08:00">2021-10-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Quantitative-Trading/" itemprop="url" rel="index"><span itemprop="name">Quantitative Trading</span></a>
                </span>
            </span>

          
            <span id="/2021/08/30/2021-08-30-pair-trading-distance-approach/" class="post-meta-item leancloud_visitors" data-flag-title="【Pair Trading】Part 2. 5 in-depth analysis of distance approach in pair trading" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2021/08/30/2021-08-30-pair-trading-distance-approach/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/08/30/2021-08-30-pair-trading-distance-approach/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <img data-src="/2021/08/30/2021-08-30-pair-trading-distance-approach/cover.jpg" class="" width="600">
<p style="font-size: 0.8em; text-align:center; color: grey;">
    <i></i>
</p>

<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left"><strong>Previous readings</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><a href="https://mikelhsia.github.io/2021/08/02/2021-08-12-pair-trading/">【Pair Trading】Introduction to pair trading strategy</a></td>
</tr>
</tbody>
</table>
</div>
<p>After knowing what the pair trading strategy is about from the <a href="https://mikelhsia.github.io/2021/08/02/2021-08-12-pair-trading/">previous post</a>, we’re going to use the <a target="_blank" rel="noopener" href="https://www.quantconnect.com/">QuantConnect platform</a> to research and validate each variation of the <strong><em>distance method</em></strong>. The agenda of this post would be:</p>
<ol>
<li><strong>Introduction</strong>: what is the distance approach and what are its variants</li>
<li><strong>Research methodology</strong>: the methodology we use to conduct this research</li>
<li><strong>Research and performance analysis</strong>: Implement each variation and compare</li>
</ol>
<p>Let’s get it started!</p>
<a id="more"></a>
<img data-src="/2021/08/30/2021-08-30-pair-trading-distance-approach/get_started.jpg" class="" width="150">
<hr>

<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>The distance approach in pair trading was first popularized by Gatev, Goetzmann, and Rouwenhorst in their <a target="_blank" rel="noopener" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=141615">academic paper</a> in 2006. This was because of its effectiveness of selecting the paired stocks that track each other well back then. Along with the simplicity in calculating the distance which saves computation resources, this academic paper became the most cited paper of pair trading strategy and derived many different strategies to further discover the relationship between stocks in the stock pair.</p>
<h2 id="Basic-distance-approach"><a href="#Basic-distance-approach" class="headerlink" title="Basic distance approach"></a>Basic distance approach</h2><p>The basic idea of the distance approach is to use data in the formation period to calculate the <strong>Euclidean squared distances</strong> between each pair of normalized prices during the pair selection process. This <strong>Euclidean squared distance</strong> can be interpreted as the similarity of how do the stock normalized prices move in a defined period. The smaller the <strong>Euclidean squared distance</strong> of a stock pair is, the more similar movements these two assets have. Therefore, we’re going to pick the stock pair that has the smallest <strong>Euclidean squared distance</strong> as its spread should be stable enough to expect the spread will revert when rising to the peak or hitting the rock bottom.</p>
<script type="math/tex; mode=display">SSD (Sum\ of\ Squared\ Distance) = \sum \limits _{t=1} ^{N} ({P^1}_t - {P^2}_t)^2</script><p style="font-size: 0.8em; text-align:center; color: grey;">
    <i><font >The formula of Euclidean squared distance</i>
</p>

<h2 id="Variants-of-distance-approach"><a href="#Variants-of-distance-approach" class="headerlink" title="Variants of distance approach"></a>Variants of distance approach</h2><p>Other than using <strong>Euclidean squared distance</strong> to evaluate how two assets are correlated, there are other methods evolving from the basic strategy such as Pearson’s correlation, distance correlation, angular distance, and so on. Also, there are other additional ideas added to the distance approach to discover what is the best-fit stock pair to be traded. The following methods were introduced in the below papers: <a target="_blank" rel="noopener" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=141615">Gatev et al. (2006): Pairs Trading: Performance of a Relative Value Arbitrage Rule</a>, <a target="_blank" rel="noopener" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=1707125">Do and Faff(2011): Are Pairs Trading Profits Robust to Trading Costs?</a>, <a target="_blank" rel="noopener" href="https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.547.8922&amp;rep=rep1&amp;type=pdf">Do and Faff (2012): Does Simple Pairs Trading Still Work?</a>. These approaches are:</p>
<ol>
<li>Selecting pairs that are in the same industry group</li>
<li>Selecting pairs with a higher number of zero-crossings</li>
<li>Selecting pairs with a higher historical variance</li>
<li>Selecting pairs with a higher Pearson’s correlation</li>
</ol>
<h1 id="Research-methodology"><a href="#Research-methodology" class="headerlink" title="Research methodology"></a>Research methodology</h1><p>To find out which one is the most effective method among distance approach and its variants, we have to set up a few rules to make sure that all backtests we are going to perform are tested under the same controlled environment:</p>
<ol>
<li>Use the constituents of the S&amp;P 500 index as our universe, meaning we will consider only the stocks that are in the S&amp;P 500 index.</li>
<li>Take <strong>12+12</strong> months’ daily close price of each stock in our defined universe. Data from the first 12-month period was used to form/train our pair trading model, and then the following 12 months’ data were used to backtest the model against the real-world scenario.</li>
<li>Normalize price data before we train our pair trading model. Let’s say we have stock A price ranging from \$100 ~ \$180, stock B price sits around \$20.00, and stock C price is over \$1000. The distances between pair A-B and pair B-C won’t be comparable because they don’t share the same starting point. Therefore normalizing price data removes the differences between two stock prices in order to make all pairs comparable.</li>
<li>As there are <strong>121,771</strong> pairs been generated, we reserve the top 10% and drop the remaining 90% of the under-performed pair in order not to waste time to analyze the pairs that are not significantly correlated.</li>
<li>Rank the stocks by the possibility of getting a positive return the next day (from high to low). The way to decide the possibility is different in every variant.</li>
<li>We calculate and analyze the expected return from two different angles in order to evaluate which strategy is better:<br> 6.1. <strong>Stratified analysis</strong>: Separate the stock pairs into 8 groups in order to see whether a higher possibility would actually result in a higher positive return.<br> 6.2. <strong>Long strategy analysis</strong>: Take the first 20 stocks to calculate the expected return so that we won’t take in too many noises into our performance analysis.</li>
<li>Generate trading signals:<br> 7.1. If the spread value exceeds 1.5 times of the historical deviations of the spread ($1.5\sigma$), generate a sell signal.<br> 7.2. If the spread value drops below 1.5 times of the historical deviations of the spread ($1.5\sigma$), generate a buy signal<br> 7.3. Close the open position when spread crosses over above or below the zero-line of the historical deviation.</li>
</ol>
<blockquote>
<p>Tips:</p>
<ol>
<li><code>itertools.combinations()</code> is a good util tool to create combinations contain two different symbols, for example <code>(&#39;AAPL&#39;,&#39;AMZN&#39;)</code></li>
<li>Normalization formula: $P_{Normalized} = \frac{P - min(P)}{max(P) - min(P)}$.</li>
<li>$min(P)$ and $max(P)$ are extracted from the formation period, and apply to the price data in backtest period</li>
</ol>
</blockquote>
<h1 id="Research-and-performance-analysis"><a href="#Research-and-performance-analysis" class="headerlink" title="Research and performance analysis"></a>Research and performance analysis</h1><p>Here we’re going to quickly talk about them and then we’ll conduct research and backtest against the basic distance approach and its variants.</p>
<h2 id="Basic-distance-approach-1"><a href="#Basic-distance-approach-1" class="headerlink" title="Basic distance approach"></a>Basic distance approach</h2><h3 id="Approach-description"><a href="#Approach-description" class="headerlink" title="Approach description"></a>Approach description</h3><p>We calculate the SSD of each pair and take the top 10% pairs which have the smallest SSD to conduct the performance analysis.</p>
<h3 id="Stratified-analysis"><a href="#Stratified-analysis" class="headerlink" title="Stratified analysis"></a>Stratified analysis</h3><p>Among 8 groups, group 1 contains the pairs that have the smallest SSD, and group 8 contains the pairs that have the biggest SSD. However, group 1 doesn’t seem to generate a positive expected return and group 8 doesn’t induce the relative huge loss as expected. The magnitude of SSD doesn’t seem to positively correlate to the expected return as we expect.</p>
<img data-src="/2021/08/30/2021-08-30-pair-trading-distance-approach/basic_stratified.png" class="" width="600">
<p style="font-size: 0.8em; text-align:center; color: grey;">
    <i>Basic distance approach stratified analysis</i>
</p>

<h3 id="Long-strategy-performance-analysis"><a href="#Long-strategy-performance-analysis" class="headerlink" title="Long strategy performance analysis"></a>Long strategy performance analysis</h3><p>If we long 20 the most stable stock pair by picking the pairs that have the smallest SSD, the portfolio still doesn’t generate a positive portfolio return over 12 months.<br><img data-src="/2021/08/30/2021-08-30-pair-trading-distance-approach/basic_top.png" class="" width="600"></p>
<p style="font-size: 0.8em; text-align:center; color: grey;">
    <i>Basic distance approach long strategy analysis (Top 20 stocks)</i>
</p>

<h2 id="Selecting-pairs-that-are-in-the-same-industry-group"><a href="#Selecting-pairs-that-are-in-the-same-industry-group" class="headerlink" title="Selecting pairs that are in the same industry group"></a>Selecting pairs that are in the same industry group</h2><p>This method holds an assumption that the paired stocks that are in the same industry are more likely to move together. So the idea here is to categorize each company by <a target="_blank" rel="noopener" href="https://www.equitieslab.com/wiki/admin/morningstar-sector">Morning Star sector code</a> and pair the stocks within the same sector/industry group. Once we have these pairs from the same industry prepared, then we do exactly the same as the basic distance approach in order to analyze the portfolio performance.</p>
<h3 id="Stratified-analysis-1"><a href="#Stratified-analysis-1" class="headerlink" title="Stratified analysis"></a>Stratified analysis</h3><p>It’s still a mess. Our group 1 that suppose to make the most profit actually incurred the most loss. The lines that represented the accumulated return of each group tangled tightly instead of staying apart from each other.<br><img data-src="/2021/08/30/2021-08-30-pair-trading-distance-approach/same_industry_stratified.png" class="" width="600"></p>
<p style="font-size: 0.8em; text-align:center; color: grey;">
    <i>Same industry distance approach stratified analysis</i>
</p>

<h3 id="Stratified-analysis-by-sector"><a href="#Stratified-analysis-by-sector" class="headerlink" title="Stratified analysis by sector"></a>Stratified analysis by sector</h3><p>One more analysis we can do is to see which sector performs the worst. The sectors that perform the worst are <code>101</code> and <code>206</code>, which are the <code>Material</code> and the <code>Health care</code> sectors. Therefore by conducting the stratified analysis by sector, we could potentially initiate another strategy by removing the sectors that perform worse in the first place.<br><img data-src="/2021/08/30/2021-08-30-pair-trading-distance-approach/same_industry_return_by_sector.png" class="" width="600"></p>
<p style="font-size: 0.8em; text-align:center; color: grey;">
    <i>Expected return by sector</i>
</p>

<h3 id="Long-strategy-performance-analysis-1"><a href="#Long-strategy-performance-analysis-1" class="headerlink" title="Long strategy performance analysis"></a>Long strategy performance analysis</h3><p>It’s quite interesting to tell the line is very similar to the expected return above, meaning the top 20 pairs we picked could highly resemble the top 20 pairs in the basic distance approach. In terms of return, nothing gets improved. But one thing to be noticed is that by creating pairs within the same industry, we reduce the total pair from <strong>121,771</strong> pairs to <strong>13,207</strong> pairs and greatly reduce the time needed for the calculation.<br><img data-src="/2021/08/30/2021-08-30-pair-trading-distance-approach/same_industry_top.png" class="" width="600"></p>
<p style="font-size: 0.8em; text-align:center; color: grey;">
    <i>Same industry distance approach long strategy analysis (Top 20 stocks)</i>
</p>

<h2 id="Selecting-pairs-with-a-higher-number-of-zero-crossings"><a href="#Selecting-pairs-with-a-higher-number-of-zero-crossings" class="headerlink" title="Selecting pairs with a higher number of zero-crossings"></a>Selecting pairs with a higher number of zero-crossings</h2><p>It’s a good sign that the spread of the paired stocks is stable enough. However, if the spread of a certain pair is way too stable, there will be no chance for the traders to step in and make a profit. Therefore in this variant, among the top 10% pairs that have the smallest <strong>Euclidean squared distance</strong>, we further pick the pairs that had the highest number of crossing the zero-spread line. A high number of zero-crossing gives this pair enough energy to swing up and down, but without losing the ability to maintain its stability and come back to the zero-spread line.</p>
<p>Here’s a tip to share with you, that it’s fairly simple to calculate the number of zero-crossing if you have your spread in proper time-series format.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Both price_a and price_b are nd.array or pd.Series objects</span></span><br><span class="line">spread = pd.Series((price_a - price_b).reshape(<span class="number">-1</span>))</span><br><span class="line">num_of_zero_crossing = ((spread * spread.shift())&lt;<span class="number">0</span>).sum()</span><br></pre></td></tr></table></figure></p>
<img data-src="/2021/08/30/2021-08-30-pair-trading-distance-approach/zero-crossing.png" class="" width="500">
<p style="font-size: 0.8em; text-align:center; color: grey;">
    <i>Why the number of zero-crossing matters</i>
</p>

<h3 id="Stratified-analysis-2"><a href="#Stratified-analysis-2" class="headerlink" title="Stratified analysis"></a>Stratified analysis</h3><p>Now we do see the differences by adding the zero-crossing criteria. The first two groups that have the highest number of zero-crossing did stand out in the accumulated performance. However, the expected return of low zero-crossing pairs doesn’t tell us that we can count on this to form a market-neutral strategy. Maybe a long-only strategy would be better off.</p>
<img data-src="/2021/08/30/2021-08-30-pair-trading-distance-approach/zerocrossing_stratified.png" class="" width="600">
<p style="font-size: 0.8em; text-align:center; color: grey;">
    <i>Zero-crossing distance approach stratified analysis</i>
</p>

<h3 id="Long-strategy-performance-analysis-2"><a href="#Long-strategy-performance-analysis-2" class="headerlink" title="Long strategy performance analysis"></a>Long strategy performance analysis</h3><p>It does! THe long-only strategy definitely helps gradually accumulate our portfolio return. This diagram kind of proving our assumption that the high value of zero-crossing would single out the pairs that are more resilient and are capable of reverting back to the normal spread level.<br><img data-src="/2021/08/30/2021-08-30-pair-trading-distance-approach/zerocrossing_top.png" class="" width="600"></p>
<p style="font-size: 0.8em; text-align:center; color: grey;">
    <i>Zero-crossing distance approach long strategy analysis (Top 20 stocks)</i>
</p>

<h2 id="Selecting-pairs-with-higher-historical-variance"><a href="#Selecting-pairs-with-higher-historical-variance" class="headerlink" title="Selecting pairs with higher historical variance"></a>Selecting pairs with higher historical variance</h2><p>This variant actually used the same idea as above <code>Selecting pairs with a higher number of zero-crossings</code>. Instead of using the number of zero-crossings, this method takes the high variance as the sign of the spread between the paired stocks being fluctuated enough to be traded.</p>
<h3 id="Stratified-analysis-3"><a href="#Stratified-analysis-3" class="headerlink" title="Stratified analysis"></a>Stratified analysis</h3><p>Um…. Don’t even bother talking about this diagram. This result obviously tells us that this variant is not a fit for market neutral strategy.<br><img data-src="/2021/08/30/2021-08-30-pair-trading-distance-approach/high_variance_stratified.png" class="" width="600"></p>
<p style="font-size: 0.8em; text-align:center; color: grey;">
    <i>High variance distance approach stratified analysis</i>
</p>

<h3 id="Long-strategy-performance-analysis-3"><a href="#Long-strategy-performance-analysis-3" class="headerlink" title="Long strategy performance analysis"></a>Long strategy performance analysis</h3><p>Even though the accumulated return looks weaker than the return from the high zero-crossing long strategy, we still can expect this long-only strategy to perform well.<br><img data-src="/2021/08/30/2021-08-30-pair-trading-distance-approach/high_variance_top.png" class="" width="600"></p>
<p style="font-size: 0.8em; text-align:center; color: grey;">
    <i>High variance distance approach long strategy analysis (Top 20 stocks)</i>
</p>

<h2 id="Selecting-pairs-with-higher-Pearson’s-correlation"><a href="#Selecting-pairs-with-higher-Pearson’s-correlation" class="headerlink" title="Selecting pairs with higher Pearson’s correlation"></a>Selecting pairs with higher <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Pearson_correlation_coefficient">Pearson’s correlation</a></h2><p>This method is relatively more complex than the above methods. This variant is mentioned in the paper <a target="_blank" rel="noopener" href="http://www.pbcsf.tsinghua.edu.cn/research/chenzhuo/paper/Empirical%20Investigation%20of%20an%20Equity%20Pairs%20Trading%20Strategy.pdf">Chen et al. (2012): Empirical Investigation of an Equity Pairs Trading Strategy</a>, and the paper <a target="_blank" rel="noopener" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3608896">Christopher Krauss (2015): Statistical arbitrage pairs trading strategies: Review and outlook</a>.</p>
<img data-src="/2021/08/30/2021-08-30-pair-trading-distance-approach/one_track_many.jpeg" class="" width="400">
<p style="font-size: 0.8em; text-align:center; color: grey;">
    <i>One tracks a group of assets instead of tracking just one</i>
</p>

<p>The idea of this method is that we’re going to use the composition of 50 stocks as the benchmark to calculate the spread against the target asset. In this way, we’ll be able to diversify the specific risk by comparing it to a basket of stocks. To do this, we will need to use Pearson’s correlation to pick out the 50 most related assets to construct the benchmark portfolio of the target asset. Then instead of using historical deviation ($1.5 \sigma$) as the threshold to trigger our trading signals, we use <strong><a target="_blank" rel="noopener" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LinearRegression.html">linear regression</a></strong> to construct the relation between two stocks and then use calculated $\alpha$ and $\beta$ to calculate the deviation. The higher the number of the deviation, the more likely deviation will revert.</p>
<script type="math/tex; mode=display">Deviation = R_{jt} - \alpha\ +\ \beta \times R_{it}</script><p>$where$</p>
<p>$R_{jt}$ is the return of the pairs portfolio</p>
<p>$R_{it}$ is the stock return</p>
<h3 id="Stratified-analysis-4"><a href="#Stratified-analysis-4" class="headerlink" title="Stratified analysis"></a>Stratified analysis</h3><p>This time we do something easier. We pick the top 20 stocks that deviate the most from its benchmark portfolio and long them and pick the bottom 20 pairs that deviate least and short them.</p>
<p>This would be the perfect variant to formulate both the market-neutral strategy and the long-only strategy. The return of the stocks we long go straight up and the return of the stocks we short go down. In the meantime, both lines are negatively correlated. When the green line drop below the bottom and break through the zero lines, the red line (the return of the stocks we short) revert and recover the loss from the green line. By longing the top 20 and shorting the bottom 20, we perfectly form the market-neutral strategy that still makes a positive return over 12 months including the bear market.<br><img data-src="/2021/08/30/2021-08-30-pair-trading-distance-approach/pearson_correlation.png" class="" width="600"></p>
<p style="font-size: 0.8em; text-align:center; color: grey;">
    <i>Pearson's correlation distance approach market neutral strategy</i>
</p>

<p><br></p>
<p><br><div style="border: 2pt solid lightgrey;border-radius: 4pt;box-shadow: 7px 7px lightgrey;padding: 1.3em;width:50%;margin:auto;">
<i><b style="font-size:1.3em;padding: 1.3em;color:grey;">"Home Run!"</b></i>
<img data-src="/2021/08/30/2021-08-30-pair-trading-distance-approach/homerun.jpg" class="" width="300">
</div><br></p>
<h1 id="Final-words-and-next-step"><a href="#Final-words-and-next-step" class="headerlink" title="Final words and next step"></a>Final words and next step</h1><p>Through the above researches, you can tell that the pair trading strategy is consist of four parts:</p>
<ol>
<li>Pair selection</li>
<li>Model formation (to form $\sigma$ or benchmark return in Pearson’s correlation variant)</li>
<li>Monitoring the current stats</li>
<li>Generate trading signals against the trained model</li>
</ol>
<p>The most important part I believe would be the pair selection part as I believe it’s crucial to find the pair/stock that does bounce back when the spread/price hit the ceiling and the floor. So essentially it’s still considered a mean reversion strategy.</p>
<p>Even though we have found our perfect strategy among these five variants, there are many things that we haven’t looked at such as:</p>
<ol>
<li>Should we use the rolling window to constantly update our model?</li>
<li>Should we trade more than 20 stocks at a time?</li>
<li>Should we find some other formulas to replace the Pearson’s correlation in order to find the more correlated paired stocks?</li>
<li>Should we expand the <strong>whole</strong> universe instead of only looking at the stocks in S&amp;P 500?</li>
</ol>
<p>These can be the potential improvements that can be experimented with. Also, make sure you run the proper backtest using the backtesting platform as <a target="_blank" rel="noopener" href="https://www.quantconnect.com/">QuantConnect</a> or <a target="_blank" rel="noopener" href="https://www.joinquant.com/">JointQaunt</a> to make sure you validate your algorithm against the real-world scenario.</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul>
<li><a target="_blank" rel="noopener" href="https://opencodecom.net/post/2021-04-30-pairs-trading-replicating-gatev-goetzmann-and-rouwenhorst-2006/">Pairs Trading: Replicating Gatev, Goetzmann and Rouwenhorst (2006)</a></li>
<li><a target="_blank" rel="noopener" href="https://hudsonthames.org/research/">Hudson &amp; Thames Official website</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/channel/UC8hI87gt0dmTAIEupEcsckA">Hudson &amp; Thames Youtube channel</a></li>
<li><a target="_blank" rel="noopener" href="http://www.pbcsf.tsinghua.edu.cn/research/chenzhuo/paper/Empirical%20Investigation%20of%20an%20Equity%20Pairs%20Trading%20Strategy.pdf">Empirical Investigation of an Equity Pairs Trading Strategy</a></li>
<li><a target="_blank" rel="noopener" href="https://www.quantconnect.com/tutorials/strategy-library/pairs-trading-with-stocks">QuantConnect Tutorials - Pair trading with stocks</a></li>
</ul>

    </div>
    
      
        <div>
    <p style="color: grey; font-family: Georgia; font-size: 1.2em;"><i>
        Disclaimer: Nothing herein is financial advice or even a recommendation to trade real money. Many platforms exist for simulated trading (paper trading) which can be used for building and developing the strategies discussed. Please use common sense and consult a professional before trading or investing your hard-earned money.
    </i></p>
</div>




      
    

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Strategy/" rel="tag"># Strategy</a>
              <a href="/tags/Research/" rel="tag"># Research</a>
              <a href="/tags/Pair-Trading/" rel="tag"># Pair Trading</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/08/02/2021-08-12-pair-trading/" rel="prev" title="【Pair Trading】Part 1. Introduction to pair trading strategy">
      <i class="fa fa-chevron-left"></i> 【Pair Trading】Part 1. Introduction to pair trading strategy
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/09/30/2021-10-05-pair-trading-market-neutral/" rel="next" title="【Pair Trading】Part 3. The strategy that helps minimize your portfolio risk">
      【Pair Trading】Part 3. The strategy that helps minimize your portfolio risk <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Basic-distance-approach"><span class="nav-number">1.1.</span> <span class="nav-text">Basic distance approach</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Variants-of-distance-approach"><span class="nav-number">1.2.</span> <span class="nav-text">Variants of distance approach</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Research-methodology"><span class="nav-number">2.</span> <span class="nav-text">Research methodology</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Research-and-performance-analysis"><span class="nav-number">3.</span> <span class="nav-text">Research and performance analysis</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Basic-distance-approach-1"><span class="nav-number">3.1.</span> <span class="nav-text">Basic distance approach</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Approach-description"><span class="nav-number">3.1.1.</span> <span class="nav-text">Approach description</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Stratified-analysis"><span class="nav-number">3.1.2.</span> <span class="nav-text">Stratified analysis</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Long-strategy-performance-analysis"><span class="nav-number">3.1.3.</span> <span class="nav-text">Long strategy performance analysis</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Selecting-pairs-that-are-in-the-same-industry-group"><span class="nav-number">3.2.</span> <span class="nav-text">Selecting pairs that are in the same industry group</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Stratified-analysis-1"><span class="nav-number">3.2.1.</span> <span class="nav-text">Stratified analysis</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Stratified-analysis-by-sector"><span class="nav-number">3.2.2.</span> <span class="nav-text">Stratified analysis by sector</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Long-strategy-performance-analysis-1"><span class="nav-number">3.2.3.</span> <span class="nav-text">Long strategy performance analysis</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Selecting-pairs-with-a-higher-number-of-zero-crossings"><span class="nav-number">3.3.</span> <span class="nav-text">Selecting pairs with a higher number of zero-crossings</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Stratified-analysis-2"><span class="nav-number">3.3.1.</span> <span class="nav-text">Stratified analysis</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Long-strategy-performance-analysis-2"><span class="nav-number">3.3.2.</span> <span class="nav-text">Long strategy performance analysis</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Selecting-pairs-with-higher-historical-variance"><span class="nav-number">3.4.</span> <span class="nav-text">Selecting pairs with higher historical variance</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Stratified-analysis-3"><span class="nav-number">3.4.1.</span> <span class="nav-text">Stratified analysis</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Long-strategy-performance-analysis-3"><span class="nav-number">3.4.2.</span> <span class="nav-text">Long strategy performance analysis</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Selecting-pairs-with-higher-Pearson%E2%80%99s-correlation"><span class="nav-number">3.5.</span> <span class="nav-text">Selecting pairs with higher Pearson’s correlation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Stratified-analysis-4"><span class="nav-number">3.5.1.</span> <span class="nav-text">Stratified analysis</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Final-words-and-next-step"><span class="nav-number">4.</span> <span class="nav-text">Final words and next step</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Reference"><span class="nav-number">5.</span> <span class="nav-text">Reference</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Michael Hsia</p>
  <div class="site-description" itemprop="description">Free your potential with learning for the rest of your life</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">36</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">tags</span></a>
      </div>

  </nav>
    

  <div class="">

    <div class="">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>

</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Michael Hsia</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'xqc1TRzBeSqWMcMIO6i05hrV-MdYXbMMI',
      appKey     : '8y8oPqyB7YE9KwpM33MRijdR',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
